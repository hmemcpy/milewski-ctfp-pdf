% Cover for Lulu.com
\input{opt-ustrade}

\documentclass[\OPTfontsize]{article}
\input{opt-color}

\usepackage{rotating}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{lettrine}
\usepackage{graphicx}
\usepackage[many]{tcolorbox}
\usetikzlibrary{calc,positioning, shadings}

\definecolor{covercolor}{cmyk}{\OPTcovercolor}
\definecolor{spinecolor}{cmyk}{\OPTspinecolor}
\definecolor{covertext}{cmyk}{\OPTcovertextcolor}
\definecolor{spinetext}{RGB}{248,154,14}
\pagecolor{covercolor}

%%% Set the fonts
\usepackage[T1]{fontenc}
\usepackage{Alegreya} %% Option 'black' gives heavier bold face 

\newcommand{\olpath}{../}
\newcommand{\whitebg}[1]{%
\tikz\node[circle,draw,minimum size=.9cm,
fill=white,
path picture={
    \node at (path picture bounding box){
        \includegraphics[width=.9cm]{\olpath#1}
    };
}]{};
}
\input{\olpath/version}

% Some of these dimensions are reported by Lulu.com *after* you
% upload the inner PDF file.
% For casewrap hardcover see http://static.lulu.com/static/images/help_casewrap_6x9.gif

\newlength{\totalwidth}
\setlength{\totalwidth}{1064.571pt} % Reported as total cover width

\newlength{\totalheight}
\setlength{\totalheight}{774pt} % Reported as total cover height

\newlength{\spinewidth}
\setlength{\spinewidth}{74.571pt} % Reported as spine width

\newlength{\coverheight}
\setlength{\coverheight}{666pt} % Height of text area

\newlength{\coverwidth}
\setlength{\coverwidth}{441pt} % Width of text area

\usepackage[margin=0pt,
            papersize={\totalwidth,\totalheight},
            noheadfoot]{geometry}
%\usepackage{layout}
\newcommand{\coverpage}[1]{\vbox to \coverheight{\hbox to \coverwidth{#1}}}
\newcommand{\spine}[1]{\vbox to \coverheight{\hbox to \spinewidth{#1}}}

\parindent=0pt
\parskip=0pt

\newcommand{\background}{
  \begin{tikzpicture}[overlay,remember picture]
    \fill [left color=gray!30, right color=covercolor] 
        (current page.north west) rectangle (current page.south east) ;
  \end{tikzpicture}
}

\newcommand{\frontpage}{
\begin{minipage}[b][\coverheight][c]{\coverwidth}
\hbox{}\hfill
\begin{minipage}[b][\coverheight][t]{0.9\coverwidth}
\color{covertext}
\centering
\vspace{\OPTtopskip}
{\fontsize{\OPTcovertitlefont}{\OPTcovertitlefont}\bfseries\selectfont%
  CATEGORY THEORY\\
  \vfill FOR PROGRAMMERS}\par
\vfill
\hspace*{-.5cm}\includegraphics[width=.6\coverwidth]{piggie}
\vfill


{\Huge\bfseries\selectfont
Bartosz Milewski

\vspace*{\OPTbotskip}
}

\end{minipage}\hfill\hbox{}
\end{minipage}
}

\newcommand{\spinetext}{
\colorbox{spinecolor}{
  \begin{minipage}[b][\coverheight][t]{\spinewidth}
  \begin{center}
    \begin{rotate}{-90}
      \color{covertext}
      \hspace{\OPTtopskip}
      \begin{minipage}{\coverheight}
        {\color{spinetext}\bfseries\Huge\selectfont%
          Category Theory for Programmers \hspace{2em} Bartosz Milewski}
      \end{minipage}
    \end{rotate}
  \end{center}
  \end{minipage}
  }
}

\newcommand{\backpage}{
\begin{minipage}[b][\coverheight][t]{\coverwidth}
\begin{center}
\begin{minipage}[t]{.8\coverwidth}
  \color{covertext}
  \vspace{\OPTtopskip}
  \input{blurb}
  \includegraphics[width=.8\coverwidth]{bunnies}
\end{minipage}
\begin{minipage}{.9\textwidth}
  \rule{\textwidth}{0.4pt}
  \begin{tabular}[h]{p{4cm} p{12cm}}
    \vspace{0pt}
      \begin{tcolorbox}[beamer,
        width=4cm,
        arc=0pt,
        boxsep=0pt,
        left=0pt,right=0pt,top=0pt,bottom=0pt,
        ] \includegraphics[width=4cm]{bartosz}
      \end{tcolorbox}
    &
    \vspace{0pt}
    \begin{minipage}[b]{.55\coverwidth}
      \fontsize{11pt}{1.4em}\selectfont\textit{Category Theory for Programmers}
        by Bartosz Milewski is licensed under a Creative Commons Attribution 4.0
        International License.\\
        \vfil
        Visit bartoszmilewski.com for more posts on Category Theory and other topics.\\
    \break
    \begin{minipage}[b]{4cm}
      \whitebg{fig/icons/by}
      \whitebg{fig/icons/cc}
      \whitebg{fig/icons/sa}
    \end{minipage}\\
    Edited by Igal Tabachnik
  \end{minipage}
  \begin{minipage}{.9\coverwidth}
    \centering
    \vspace{-25mm}
    \includegraphics[width=2in]{isbn_barcode}\\
    \tiny{\texttt{\OPTversion}}
  \end{minipage}
\end{tabular}
\end{minipage}
\end{center}
\end{minipage}
}

\begin{document}
% \background
\begin{center}
  \vbox{}
  \vfill
  \mbox{\coverpage{\backpage}\spine{\spinetext}\coverpage{\frontpage}}
  \vfill
\end{center}
\end{document}